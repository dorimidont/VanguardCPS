<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>
        {% if page.title %}{{ page.title | escape }} | {% endif %}{{ site.title | default: "Организация" | escape }}
    </title>

    <!-- Мета-описание для SEO -->
    <meta name="description" content="{{ page.description | default: site.description | strip_html | normalize_whitespace | truncate: 160 }}">

    <!-- Open Graph для социальных сетей -->
    {% if page.image %}
    <meta property="og:image" content="{{ page.image | absolute_url }}">
    {% elsif site.image %}
    <meta property="og:image" content="{{ site.image | absolute_url }}">
    {% endif %}

    <!-- Favicon -->
    <link rel="icon" href="{{ '/assets/favicon.ico' | relative_url }}" type="image/x-icon">

    <!-- Основные стили -->
    <link rel="stylesheet" href="{{ '/assets/css/main.css' | relative_url }}">

    <!-- Дополнительные стили для текущей страницы -->
    {% if page.stylesheets %}
        {% for stylesheet in page.stylesheets %}
        <link rel="stylesheet" href="{{ stylesheet | relative_url }}">
        {% endfor %}
    {% endif %}

    <!-- Скрипты в head (по необходимости) -->
    {% if page.scripts_head %}
        {% for script in page.scripts_head %}
        <script src="{{ script | relative_url }}" defer></script>
        {% endfor %}
    {% endif %}
</head>
<body>
    <!-- Верхняя панель (опционально) -->
    {% if site.show_top_bar %}
    <div class="top-bar">
        <div class="top-bar-container">
            <ul class="top-bar-links">
                {% for link in site.top_bar_links %}
                <li><a href="{{ link.url | relative_url }}" {% if link.external %}target="_blank" rel="noopener"{% endif %}>{{ link.title }}</a></li>
                {% endfor %}
            </ul>
        </div>
    </div>
    {% endif %}

    <!-- Основной хедер -->
    {% include header.html %}

    <!-- Контейнер для основного контента -->
    <div class="site-container">
        <!-- Хлебные крошки (опционально) -->
        {% unless page.hide_breadcrumbs or page.layout == 'home' %}
        <nav class="breadcrumbs" aria-label="Хлебные крошки">
            <div class="breadcrumbs-container">
                <a href="{{ '/' | relative_url }}">Главная</a>
                {% if page.categories %}
                    {% for category in page.categories %}
                    <span aria-hidden="true">/</span>
                    <a href="{{ '/categories/' | append: category | slugify | relative_url }}">{{ category }}</a>
                    {% endfor %}
                {% endif %}
                <span aria-hidden="true">/</span>
                <span class="current">{{ page.title }}</span>
            </div>
        </nav>
        {% endunless %}

        <!-- Основной контент -->
        <main class="main-content" id="main-content" aria-label="Основной контент">
            {{ content }}
        </main>

        <!-- Сайдбар (опционально) -->
        {% if page.sidebar %}
        <aside class="sidebar" aria-label="Дополнительная информация">
            {% include sidebar.html %}
        </aside>
        {% endif %}
    </div>

    <!-- Футер -->
    {% include footer.html %}

    <!-- Скрипты -->
    <script>
    // Скрипт для мобильного меню
    document.addEventListener('DOMContentLoaded', function() {
        const menuToggle = document.querySelector('.menu-toggle');
        const mainNav = document.querySelector('.main-nav');

        if (menuToggle) {
            menuToggle.addEventListener('click', function() {
                this.classList.toggle('active');
                if (mainNav) mainNav.classList.toggle('active');
                this.setAttribute('aria-expanded',
                    this.classList.contains('active') ? 'true' : 'false'
                );
            });
        }

        // Закрытие меню при клике на ссылку
        document.querySelectorAll('.nav-item a').forEach(link => {
            link.addEventListener('click', () => {
                if (menuToggle) menuToggle.classList.remove('active');
                if (mainNav) mainNav.classList.remove('active');
                if (menuToggle) menuToggle.setAttribute('aria-expanded', 'false');
            });
        });

        // Плавная прокрутка к якорям
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function(e) {
                if (this.getAttribute('href') === '#') return;

                e.preventDefault();
                const targetId = this.getAttribute('href');
                const targetElement = document.querySelector(targetId);

                if (targetElement) {
                    window.scrollTo({
                        top: targetElement.offsetTop - 80,
                        behavior: 'smooth'
                    });

                    // Обновляем URL без перезагрузки страницы
                    history.pushState(null, null, targetId);
                }
            });
        });
    });
    </script>
    
    <!-- Внешние скрипты -->
    {% if page.scripts %}
        {% for script in page.scripts %}
        <script src="{{ script | relative_url }}" defer></script>
        {% endfor %}
    {% endif %}

    <!-- Аналитика (Google Analytics) -->
    {% if site.google_analytics %}
    <script async src="https://www.googletagmanager.com/gtag/js?id={{ site.google_analytics }}"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', '{{ site.google_analytics }}');
    </script>
    {% endif %}
</body>
</html>
